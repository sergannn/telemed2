# Документация по тестам проекта DoctorQ

Этот документ описывает все тесты в проекте, их назначение и что они проверяют.

## Содержание

1. [Тесты авторизации и сессии](#тесты-авторизации-и-сессии)
2. [Тесты моделей данных](#тесты-моделей-данных)
3. [Тесты экранов](#тесты-экранов)
4. [Тесты бизнес-логики](#тесты-бизнес-логики)
5. [Тесты UI компонентов](#тесты-ui-компонентов)

---

## Тесты авторизации и сессии

### `test/auth_test.dart` - Тесты авторизации и работы с сессией

**Назначение:** Проверяет работу системы авторизации, сохранение и получение данных пользователя из сессии.

**Что проверяет:**
- ✅ Инициализация сессии
- ✅ Сохранение пользователя в сессию
- ✅ Получение текущего пользователя из сессии
- ✅ Возврат `null` когда пользователь не авторизован
- ✅ Обновление отдельного поля пользователя
- ✅ Обновление нескольких полей пользователя
- ✅ Работа с пользователями-врачами (с `doctor_id`)
- ✅ Работа с пользователями-пациентами (с `patient_id`)
- ✅ Обработка ошибок при обновлении несуществующего поля
- ✅ Обновление поля `gender`

**Количество тестов:** 10

**Как работает:**
1. Перед каждым тестом очищается хранилище SharedPreferences
2. Создается тестовый пользователь с различными параметрами
3. Пользователь сохраняется через `Session().saveUser()`
4. Проверяется, что данные корректно сохранились и могут быть получены
5. Тестируются различные сценарии обновления данных

---

### `test/registration_test.dart` - Тесты регистрации врачей

**Назначение:** Проверяет функциональность регистрации новых пользователей-врачей.

**Что проверяет:**
- ✅ Существование функции `regUser` для регистрации
- ✅ Валидация параметров регистрации

**Количество тестов:** 2

**Как работает:**
1. Инициализируется тестовая среда
2. Проверяется наличие функции регистрации
3. Проверяется корректность параметров функции

**Примечание:** Полные тесты регистрации требуют BuildContext, поэтому проверяется только наличие функции.

---

## Тесты моделей данных

### `test/user_model_test.dart` - Тесты модели пользователя

**Назначение:** Проверяет корректность работы модели `UserModel` - создание, сериализация и десериализация.

**Что проверяет:**
- ✅ Создание UserModel со всеми полями
- ✅ Создание UserModel из JSON
- ✅ Конвертация UserModel в JSON
- ✅ Обработка null значений в полях
- ✅ Корректная работа с полем `gender` (1 - мужской, 2 - женский)

**Количество тестов:** 5

**Как работает:**
1. Создается экземпляр UserModel с тестовыми данными
2. Проверяется, что все поля установлены корректно
3. Тестируется преобразование в/из JSON
4. Проверяется обработка null значений

---

## Тесты экранов

### `test/home_screen_test.dart` - Тесты главного экрана

**Назначение:** Проверяет корректное отображение главного экрана приложения для разных типов пользователей.

**Что проверяет:**
- ✅ Отображение экрана для пользователя-пациента
- ✅ Отображение экрана для пользователя-врача
- ✅ Инициализация экрана

**Количество тестов:** 3

**Как работает:**
1. Создается тестовый пользователь (пациент или врач)
2. Пользователь сохраняется в сессию
3. Создается виджет HomeScreen
4. Проверяется, что экран успешно отображается

---

### `test/appointments_screen_test.dart` - Тесты экрана записей на прием

**Назначение:** Проверяет работу экрана со списком записей на прием.

**Что проверяет:**
- ✅ Отображение экрана записей
- ✅ Отображение экрана с параметром `mode: 'old'` (прошедшие записи)
- ✅ Создание экземпляра AppointmentsScreen
- ✅ Обработка изменений состояния экрана

**Количество тестов:** 4

**Как работает:**
1. Создается тестовый пользователь
2. Создается виджет AppointmentsScreen с разными параметрами
3. Проверяется корректное отображение экрана

---

### `test/main_screen_test.dart` - Тесты главного экрана приложения

**Назначение:** Проверяет работу главного экрана приложения с навигацией.

**Что проверяет:**
- ✅ Отображение главного экрана с навигацией
- ✅ Создание экземпляра Main
- ✅ Наличие нижней панели навигации

**Количество тестов:** 3

**Как работает:**
1. Создается тестовый пользователь
2. Создается виджет Main
3. Проверяется корректное отображение и наличие навигации

---

### `test/profile_screen_test.dart` - Тесты экрана профиля

**Назначение:** Проверяет работу экрана профиля пользователя.

**Что проверяет:**
- ✅ Отображение экрана профиля
- ✅ Создание экземпляра MainProfileScreen

**Количество тестов:** 2

**Как работает:**
1. Создается тестовый пользователь
2. Создается виджет MainProfileScreen
3. Проверяется корректное отображение экрана

---

### `test/medcard_test.dart` - Тесты медицинской карты

**Назначение:** Проверяет работу экрана медицинской карты.

**Что проверяет:**
- ✅ Отображение экрана медицинской карты
- ✅ Создание экземпляра MedCardScreen

**Количество тестов:** 2

**Как работает:**
1. Создается тестовый пользователь
2. Создается виджет MedCardScreen
3. Проверяется корректное отображение экрана

---

## Тесты бизнес-логики

### `test/appointment_completion_test.dart` - Тесты завершения приема

**Назначение:** Проверяет, что только врач может завершить прием (задача 7).

**Что проверяет:**
- ✅ Идентификация пользователя-врача по `doctor_id`
- ✅ Идентификация пользователя-пациента (без `doctor_id`)
- ✅ Проверка, что только врач может завершить прием

**Количество тестов:** 3

**Как работает:**
1. Создается пользователь-врач с `doctor_id`
2. Проверяется, что `doctor_id` не null (врач может завершить)
3. Создается пользователь-пациент без `doctor_id`
4. Проверяется, что `doctor_id` null (пациент не может завершить)

---

### `test/user_gender_test.dart` - Тесты работы с полом пользователя

**Назначение:** Проверяет корректную работу с полем `gender` пользователя (задача 12).

**Что проверяет:**
- ✅ Создание UserModel с полем gender
- ✅ Парсинг gender из JSON (1 - мужской, 2 - женский)
- ✅ Парсинг gender = 2 (женский) из JSON
- ✅ Обработка null значения gender
- ✅ Включение gender в toJson
- ✅ Проверка, является ли пользователь женщиной (gender == '2')

**Количество тестов:** 7

**Как работает:**
1. Создаются пользователи с разными значениями gender
2. Проверяется корректность сохранения и получения gender
3. Тестируется преобразование в/из JSON
4. Проверяется логика определения пола

---

### `test/menstrual_cycle_visibility_test.dart` - Тесты видимости менструального цикла

**Назначение:** Проверяет логику отображения менструального цикла в зависимости от пола (задача 12).

**Что проверяет:**
- ✅ Скрытие менструального цикла для мужчин (gender = 1)
- ✅ Отображение менструального цикла для женщин (gender = 2)
- ✅ Скрытие при null значении gender
- ✅ Обработка gender как integer 1 (MALE)
- ✅ Обработка gender как integer 2 (FEMALE)
- ✅ Корректная идентификация женского пола из строки
- ✅ Корректная идентификация женского пола из integer
- ✅ Сравнение строки и integer

**Количество тестов:** 8

**Как работает:**
1. Устанавливается значение gender (1, 2 или null)
2. Проверяется условие `gender == '2'` или `gender == 2`
3. Если true - показывать менструальный цикл, если false - скрывать

**Логика:** Менструальный цикл показывается только если `gender == '2'` или `gender == 2`

---

### `test/profile_survey_menstrual_test.dart` - Тесты менструального цикла в профиле

**Назначение:** Проверяет отображение секции менструального цикла в анкете профиля.

**Что проверяет:**
- ✅ Скрытие секции менструального цикла для мужчин (gender = 1)
- ✅ Отображение секции для женщин (gender = 2)
- ✅ Проверка значений gender
- ✅ Обработка null значения gender

**Количество тестов:** 4

**Как работает:**
1. Устанавливается значение gender
2. Проверяется условие отображения секции
3. Для gender = 2 секция показывается, для gender = 1 или null - скрывается

---

## Тесты UI компонентов

### `test/scrollable_screens_test.dart` - Тесты прокручиваемых экранов

**Назначение:** Проверяет, что экраны имеют возможность прокрутки и отступ внизу (задача 11).

**Что проверяет:**
- ✅ HomeScreen является прокручиваемым
- ✅ MainProfile является прокручиваемым
- ✅ HealthScreen является прокручиваемым

**Количество тестов:** 3

**Как работает:**
1. Создается тестовый пользователь
2. Создается виджет экрана
3. Проверяется наличие Scrollable виджета в дереве виджетов
4. Проверяется, что экран можно прокрутить

**Примечание:** Тесты проверяют наличие отступа внизу для возможности прокрутки контента.

---

### `test/tracker_removal_test.dart` - Тесты удаления трекера

**Назначение:** Проверяет, что трекер удален из HealthScreen (задача 4).

**Что проверяет:**
- ✅ HealthScreen имеет только один таб (Статьи)
- ✅ TabController имеет length = 1 (трекер убран)
- ✅ Таб трекера отсутствует в экране

**Количество тестов:** 3

**Как работает:**
1. Создается виджет HealthScreen
2. Проверяется TabBar и количество табов
3. Убеждается, что есть только таб "Статьи", таб "Трекер" отсутствует

**Ожидаемый результат:** В HealthScreen должен быть только один таб - "Статьи"

---

### `test/assistant_background_test.dart` - Тесты белого фона помощника

**Назначение:** Проверяет, что фон экрана чата с помощником изменен на белый (задача 15).

**Что проверяет:**
- ✅ ChatScreen имеет белый фон (Colors.white)
- ✅ Используется цвет вместо изображения
- ✅ Фон не является изображением

**Количество тестов:** 4

**Как работает:**
1. Создается виджет ChatScreen
2. Ищется DecoratedBox с BoxDecoration
3. Проверяется, что цвет фона равен Colors.white
4. Убеждается, что нет DecorationImage (изображения фона)

**Ожидаемый результат:** Фон ChatScreen должен быть белым цветом, а не изображением

---

### `test/date_picker_month_test.dart` - Тесты отображения месяца в календаре

**Назначение:** Проверяет корректное отображение месяца под числами в календаре (задача 9).

**Что проверяет:**
- ✅ Возврат правильного сокращения месяца на русском
- ✅ Корректный месяц для декабря
- ✅ Корректный месяц для января
- ✅ Обработка всех 12 месяцев
- ✅ Форматирование месяца для русской локали
- ✅ Обработка первого дня месяца
- ✅ Обработка последнего дня месяца
- ✅ Корректность для разных лет

**Количество тестов:** 8

**Как работает:**
1. Создается дата с определенным месяцем
2. Используется массив сокращений месяцев: ['янв', 'фев', 'мар', 'апр', 'май', 'июн', 'июл', 'авг', 'сен', 'окт', 'ноя', 'дек']
3. Проверяется, что для каждого месяца возвращается правильное сокращение
4. Тестируется форматирование через DateFormat для русской локали

**Ожидаемый результат:** Под каждым числом в календаре должен отображаться месяц в сокращенном виде (янв, фев, мар и т.д.)

---

### `test/home_screen_month_test.dart` - Тесты отображения месяца на главной странице

**Назначение:** Проверяет форматирование названия месяца на главной странице.

**Что проверяет:**
- ✅ Форматирование названия месяца на русском языке
- ✅ Корректное название для декабря
- ✅ Форматирование в родительном падеже (требуется для русского языка)
- ✅ Корректность для всех 12 месяцев

**Количество тестов:** 4

**Как работает:**
1. Создается дата
2. Используется DateFormat('MMMM', 'ru') для получения полного названия месяца
3. Проверяется корректность форматирования для всех месяцев

**Ожидаемый результат:** Месяц должен отображаться в полном названии на русском языке (январь, февраль, март и т.д.)

---

### `test/profile_update_test.dart` - Тесты обновления профиля врача

**Назначение:** Проверяет функциональность обновления профиля врача.

**Что проверяет:**
- ✅ Существование функции `updateProfileFields`
- ✅ Сохранение изменений профиля в базу данных

**Количество тестов:** 2

**Как работает:**
1. Создается тестовый пользователь-врач
2. Обновляется поле через `Session().updateUserField()`
3. Проверяется, что изменения сохранились

---

### `test/avatar_update_test.dart` - Тесты обновления аватара врача

**Назначение:** Проверяет функциональность обновления аватара врача.

**Что проверяет:**
- ✅ Обновление аватара через Session
- ✅ Сохранение нового аватара в базу данных

**Количество тестов:** 2

**Как работает:**
1. Создается тестовый пользователь-врач с аватаром
2. Обновляется поле `photo` через `Session().updateUserField()`
3. Проверяется, что новый аватар сохранился

---

## Дополнительные тесты

### `test/unit_test.dart` - Тесты для главного экрана

**Назначение:** Проверяет создание виджетов навигации для главного экрана.

**Что проверяет:**
- ✅ Создание правильного виджета для элемента навигации

**Количество тестов:** 1

**Как работает:**
1. Создается ItemConfig для элемента навигации
2. Создается CustomBottomNavBar
3. Проверяется корректное создание виджета элемента

---

### `test/widget_test.dart` - Базовый тест виджета

**Назначение:** Базовый тест-заглушка Flutter.

**Что проверяет:**
- ✅ Базовый smoke-тест приложения

**Количество тестов:** 1

**Примечание:** Это стандартный тест Flutter, может быть удален или переписан под реальную функциональность.

---

## Статистика тестов

**Общее количество тестовых файлов:** 20

**Общее количество тестов:** ~80+

**Покрытие:**
- ✅ Авторизация и сессия
- ✅ Модели данных
- ✅ Основные экраны приложения
- ✅ Бизнес-логика (пол, менструальный цикл, завершение приема)
- ✅ UI компоненты (прокрутка, фон, календарь)
- ✅ Специфичные задачи из TASKS.md

---

## Как запустить тесты

```bash
# Запустить все тесты
flutter test

# Запустить конкретный тест
flutter test test/auth_test.dart

# Запустить тесты с покрытием
flutter test --coverage
```

---

## Примечания

- Все тесты используют моки для SharedPreferences
- Перед каждым тестом очищается хранилище данных
- Тесты не требуют реального подключения к серверу
- Некоторые тесты проверяют только наличие функций (требуют BuildContext для полной проверки)

